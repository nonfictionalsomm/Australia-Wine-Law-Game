<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Wine Law Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #FDF8F2; /* Creamy background */
            color: #4B3F3F; /* Dark brown text */
        }
        h1, h2, h3, h4, h5 {
            font-family: 'Playfair+Display', serif;
        }
        .game-card {
            background-color: #FFFFFF;
            border: 1px solid #DED1C1;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-choice {
            transition: all 0.2s ease-in-out;
            border: 2px solid #DED1C1;
            background-color: #fff;
            min-height: 60px; /* Ensure buttons have a good clickable height */
            display: flex;
            width: 100%;
            align-items: center;
            justify-content: center; /* Center text */
            text-align: center;
        }
        .btn-choice:hover:not(:disabled) {
            background-color: #FDF8F2;
            transform: translateY(-2px);
        }
        .btn-choice.selected {
            background-color: #E0E7FF; /* Light blue for selected */
            border-color: #A5B4FC;
            box-shadow: 0 0 0 3px #A5B4FC;
        }
        .btn-choice:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .btn-choice.correct {
            background-color: #D1FAE5; /* Green for correct */
            border-color: #6EE7B7;
            color: #065F46;
            cursor: not-allowed;
            opacity: 1;
        }
        .btn-choice.incorrect {
            animation: shake 0.5s;
            background-color: #FEE2E2; /* Red for incorrect */
            border-color: #FCA5A5;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        /* --- Database Explorer Styles --- */
        .db-item {
            padding: 12px 16px;
            background-color: #fff;
            border: 1px solid #DED1C1;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
            padding-right: 40px; /* Space for arrow */
        }
        .db-item:hover {
            background-color: #FDF8F2;
        }
        .db-item::after { /* Arrow icon */
            content: 'â–¼';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%) rotate(0deg);
            transition: transform 0.3s ease;
            font-size: 0.8em;
            color: #8c7d7d;
        }
        .db-item.expanded::after {
            transform: translateY(-50%) rotate(-180deg);
        }
        .db-item-no-click {
            padding: 12px 16px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            font-weight: 700;
            color: #999;
            cursor: not-allowed;
        }
        .db-item-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding-left: 1.5rem; /* Indentation */
        }
        .db-item-content.expanded {
            max-height: 2000px; /* Arbitrary large height */
            transition: max-height 0.5s ease-in;
        }
        .db-zone { background-color: #fff; }
        .db-gi { background-color: #fcfaf7; }
        .db-gi-details {
            background: #FDF8F2;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px dashed #DED1C1;
        }
        .db-gi-details h5 {
            font-weight: 700;
            color: #4B3F3F;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        .db-gi-details ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        /* --- Flashcard Styles --- */
        #flashcard {
            width: 100%;
            height: 300px;
            perspective: 1000px;
            cursor: pointer;
        }
        #flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        #flashcard.flipped #flashcard-inner {
            transform: rotateY(180deg);
        }
        #flashcard-front, #flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            border-radius: 1rem;
            border: 2px solid #DED1C1;
            background-color: #FFFFFF;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        #flashcard-back {
            transform: rotateY(180deg);
            background-color: #FDF8F2;
        }
        .flashcard-prompt {
            font-size: 0.9rem;
            font-weight: 700;
            color: #8c7d7d;
            margin-bottom: 1rem;
            text-align: center;
        }
        .flashcard-content {
            font-family: 'Playfair Display', serif;
            font-size: 2.25rem;
            font-weight: 700;
            text-align: center;
        }
        .flashcard-answer {
             font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            color: #c0392b;
        }
        .btn-nav {
             background-color: #fff;
             color: #4B3F3F;
             font-weight: 700;
             padding: 0.75rem 1.5rem;
             border-radius: 8px;
             border: 2px solid #DED1C1;
             transition: all 0.2s;
        }
        .btn-nav:hover {
            background-color: #FDF8F2;
            transform: translateY(-2px);
        }
        .btn-nav:disabled {
            background-color: #f3f3f3;
            color: #aaa;
            cursor: not-allowed;
            transform: none;
            border-color: #eee;
        }
        .btn-secondary {
            background-color: #4B3F3F;
            color: #FFFFFF;
            font-weight: 700;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #3a3030;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Start Game Modal -->
    <div id="start-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center transform transition-all">
            <h2 class="text-4xl font-bold mb-4 text-red-900">Australia Wine Master</h2>
            <p class="text-lg mb-6 text-gray-700">Choose your challenge</p>
            
            <div class="space-y-3">
                <button data-mode="State-Zone" class="start-game-btn w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors text-lg">Game: State to Zone</button>
                <button data-mode="Zone-GI" class="start-game-btn w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors text-lg">Game: Zone to GI</button>
                <button data-mode="GI-Feature" class="start-game-btn w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors text-lg">Game: GI to Feature</button>
                <button data-mode="GI-Producer" class="start-game-btn w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors text-lg">Game: GI to Producer</button>
                
                <hr class="my-3 border-t-2 border-gray-200">

                <button id="flashcards-btn" class="w-full bg-blue-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-900 transition-colors text-lg">Flashcards</button>
                <button id="explore-data-btn" class="w-full bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors text-lg">Explore Data</button>
            </div>
        </div>
    </div>

    <!-- Flashcard Menu Modal -->
    <div id="flashcard-menu-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-lg w-full text-center transform transition-all">
            <h2 class="text-4xl font-bold mb-6 text-blue-900">Flashcard Decks</h2>
            <p class="text-lg mb-6 text-gray-700">Choose a deck to study</p>
            
            <div class="space-y-3">
                <button data-mode="State-Zone" class="start-flashcards-btn w-full bg-blue-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-900 transition-colors text-lg">State / Zone</button>
                <button data-mode="Zone-GI" class="start-flashcards-btn w-full bg-blue-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-900 transition-colors text-lg">Zone / GI</button>
                <button data-mode="GI-Feature" class="start-flashcards-btn w-full bg-blue-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-900 transition-colors text-lg">GI / Feature</button>
                <button data-mode="GI-Producer" class="start-flashcards-btn w-full bg-blue-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-900 transition-colors text-lg">GI / Producer</button>
                
                <hr class="my-3 border-t-2 border-gray-200">
                <button id="flashcard-menu-back-btn" class="w-full bg-gray-700 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-800 transition-colors text-lg">Main Menu</button>
            </div>
        </div>
    </div>


    <!-- Matching Game Container -->
    <div id="game-container" class="w-full max-w-4xl mx-auto hidden relative pt-20">
        <button id="game-main-menu-btn" class="absolute top-4 left-4 bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-800 transition-colors text-sm z-10">Main Menu</button>
        <div class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-red-900">Australia Wine Master</h1>
            <p class="text-lg text-gray-600 mt-2">Geographical Indication Challenge</p>
        </div>
        <div class="flex justify-between items-center mb-6 p-4 rounded-lg bg-red-800/10 text-red-900 game-card">
            <div class="text-center">
                <h3 class="text-xl font-bold">Round</h3>
                <p id="round-info" class="text-2xl font-semibold">1 / 10</p>
            </div>
            <div class="text-center">
                <h3 id="round-prompt" class="text-xl font-bold">Match the items</h3>
                <p class="text-lg">Select one item from each column to make a match.</p>
            </div>
            <div class="text-center">
                <h3 class="text-xl font-bold">Score</h3>
                <p id="score-info" class="text-2xl font-semibold">0</p>
            </div>
        </div>
        <div class="game-card rounded-lg p-6 md:p-8">
            <div class="grid grid-cols-2 gap-4 md:gap-8 mb-4">
                <h3 id="left-title" class="text-2xl font-bold text-center">Left Column</h3>
                <h3 id="right-title" class="text-2xl font-bold text-center">Right Column</h3>
            </div>
            <div id="game-rows-container" class="space-y-3">
                <!-- Rows injected by JS -->
            </div>
        </div>
    </div>

    <!-- Flashcard Container -->
    <div id="flashcard-container" class="w-full max-w-2xl mx-auto hidden relative pt-20">
        <button id="flashcard-main-menu-btn" class="absolute top-4 left-4 bg-gray-700 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-800 transition-colors text-sm z-10">Main Menu</button>
        
        <div class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-900">Flashcards</h1>
            <p id="flashcard-deck-title" class="text-lg text-gray-600 mt-2">Deck Title</p>
        </div>

        <!-- Study Mode Controls -->
        <div class="game-card rounded-lg p-4 md:p-6 mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <div class="flex items-center space-x-4">
                    <span class="font-bold">Study:</span>
                    <label class="flex items-center"><input type="radio" name="studyMode" value="all" class="study-mode-radio" checked> <span class="ml-1">All</span></label>
                    <label class="flex items-center"><input type="radio" name="studyMode" value="unlearned" class="study-mode-radio"> <span class="ml-1">Unlearned</span></label>
                    <label class="flex items-center"><input type="radio" name="studyMode" value="learned" class="study-mode-radio"> <span class="ml-1">Learned</span></label>
                </div>
                <button id="reset-deck-btn" class="btn-secondary">Reset Deck</button>
            </div>
        </div>

        <!-- Flashcard -->
        <div id="flashcard">
            <div id="flashcard-inner">
                <div id="flashcard-front">
                    <div class="flashcard-prompt">Prompt</div>
                    <div class="flashcard-content">Front Content</div>
                </div>
                <div id="flashcard-back">
                    <div class="flashcard-content flashcard-answer">Back Content</div>
                </div>
            </div>
        </div>

        <!-- Card Status -->
        <p id="flashcard-status" class="text-center text-lg font-bold text-gray-700 my-4">Card 1 of 10</p>
        <p id="flashcard-empty-deck-msg" class="text-center text-lg font-bold text-red-700 my-4 hidden">No cards in this study mode.</p>

        <!-- Navigation -->
        <div class="flex justify-between items-center mt-4">
            <button id="prev-card-btn" class="btn-nav">Previous</button>
            <button id="toggle-learned-btn" class="btn-nav">Mark as Learned</button>
            <button id="next-card-btn" class="btn-nav">Next</button>
        </div>
    </div>


    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center transform transition-all scale-95 opacity-0">
            <div id="modal-message" class="text-4xl font-bold mb-4 text-green-700">Great Job!</div>
            <button id="next-round-btn" class="w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors">Next Round</button>
        </div>
    </div>
    
    <!-- Game Over Modal -->
    <div id="game-over-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center transform transition-all scale-95 opacity-0">
            <h2 class="text-4xl font-bold mb-4 text-red-900">Game Over!</h2>
            <p id="final-score-message" class="text-3xl font-bold mb-4 text-red-800"></p>
            <div class="bg-red-800/10 p-4 rounded-lg mb-6">
                <p class="text-lg text-left clear-both">Final Score: <span id="final-score" class="font-bold float-right">0</span></p>
                <p class="text-lg text-left mt-1 clear-both">Percentage: <span id="final-percentage" class="font-bold float-right">0%</span></p>
            </div>
            <button id="play-again-btn" class="w-full bg-red-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-900 transition-colors">Play Again</button>
        </div>
    </div>

    <!-- Database Explorer Modal -->
    <div id="database-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-3xl w-full h-5/6 transform transition-all flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-4xl font-bold text-red-900">Data Explorer</h2>
                <button id="close-db-btn" class="text-3xl font-bold text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <p class="text-lg mb-4 text-gray-700">Click any item to expand and see its contents.</p>
            <div id="database-container" class="flex-grow overflow-y-auto space-y-2 pr-2">
                <!-- Database content will be injected here -->
            </div>
        </div>
    </div>


    <script>
        // --- DATA ---
        const gameData = [
            // --- New South Wales ---
            { left: "New South Wales", right: "Northern Slopes", type: "State-Zone" },
            { left: "New South Wales", right: "Northern Rivers", type: "State-Zone" },
            { left: "New South Wales", right: "Hunter Valley", type: "State-Zone" },
            { left: "New South Wales", right: "Central Ranges", type: "State-Zone" },
            { left: "New South Wales", right: "Southern New South Wales", type: "State-Zone" },
            { left: "New South Wales", right: "South Coast", type: "State-Zone" },
            { left: "New South Wales", right: "Western Plains", type: "State-Zone" },
            { left: "New South Wales", right: "Big Rivers", type: "State-Zone" },
            { left: "Northern Slopes", right: "New England Australia", type: "Zone-GI" },
            { left: "New England Australia", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "New England Australia", right: "Black Mountain", type: "GI-Feature" },
            { left: "New England Australia", right: "Peel River", type: "GI-Feature" },
            { left: "New England Australia", right: "Gwydir River", type: "GI-Feature" },
            { left: "New England Australia", right: "Severn River", type: "GI-Feature" },
            { left: "New England Australia", right: "Moonbi Hills", type: "GI-Feature" },
            { left: "New England Australia", right: "New England Estate", type: "GI-Producer" },
            { left: "New England Australia", right: "Blickling Estate", type: "GI-Producer" },
            { left: "New England Australia", right: "Jilly Wines", type: "GI-Producer" },
            { left: "Northern Rivers", right: "Hastings River", type: "Zone-GI" },
            { left: "Hastings River", right: "Broken Bago Range", type: "GI-Feature" },
            { left: "Hastings River", right: "Pacific Ocean", type: "GI-Feature" },
            { left: "Hastings River", right: "Hastings River", type: "GI-Feature" },
            { left: "Hastings River", right: "Bago Vineyards", type: "GI-Producer" },
            { left: "Hastings River", right: "Cassegrain", type: "GI-Producer" },
            { left: "Hunter Valley", right: "Hunter", type: "Zone-GI" },
            { left: "Hunter", right: "Hunter River", type: "GI-Feature" },
            { left: "Hunter", right: "Goulburn River", type: "GI-Feature" },
            { left: "Hunter", right: "Tyrrell's", type: "GI-Producer" },
            { left: "Hunter", right: "Brokenwood", type: "GI-Producer" },
            { left: "Hunter", right: "Yarraman Estate", type: "GI-Producer" },
            { left: "Hunter", right: "McWilliam's Mount Pleasant", type: "GI-Producer" },
            { left: "Hunter", right: "Keith Tulloch Wine", type: "GI-Producer" },
            { left: "Hunter", right: "Wyndham Estate", type: "GI-Producer" },
            { left: "Hunter", right: "Rosemount Estate", type: "GI-Producer" },
            { left: "Central Ranges", right: "Cowra", type: "Zone-GI" },
            { left: "Cowra", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Cowra", right: "Lachlan River", type: "GI-Feature" },
            { left: "Cowra", right: "Belubula River", type: "GI-Feature" },
            { left: "Cowra", right: "Cowra Estate", type: "GI-Producer" },
            { left: "Cowra", right: "Windowrie Estate", type: "GI-Producer" },
            { left: "Central Ranges", right: "Mudgee", type: "Zone-GI" },
            { left: "Mudgee", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Mudgee", right: "Montrose", type: "GI-Producer" },
            { left: "Mudgee", right: "Simon Gilbert Wines", type: "GI-Producer" },
            { left: "Central Ranges", right: "Orange", type: "Zone-GI" },
            { left: "Orange", right: "Mount Canobolas", type: "GI-Feature" },
            { left: "Orange", right: "Bloodwood", type: "GI-Producer" },
            { left: "Orange", right: "Canobolas-Smith", type: "GI-Producer" },
            { left: "Orange", right: "Word of Mouth", type: "GI-Producer" },
            { left: "Orange", right: "Borrodell on the Mount", type: "GI-Producer" },
            { left: "Southern New South Wales", right: "Canberra District", type: "Zone-GI" },
            { left: "Canberra District", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Canberra District", right: "Lake George", type: "GI-Feature" },
            { left: "Canberra District", right: "Clonakilla", type: "GI-Producer" },
            { left: "Canberra District", right: "Lark Hill", type: "GI-Producer" },
            { left: "Canberra District", right: "Brindabella Hills", type: "GI-Producer" },
            { left: "Canberra District", right: "Helm", type: "GI-Producer" },
            { left: "Southern New South Wales", right: "Gundagai", type: "Zone-GI" },
            { left: "Gundagai", right: "Snowy Mountains", type: "GI-Feature" },
            { left: "Gundagai", right: "Murrumbidgee River", type: "GI-Feature" },
            { left: "Gundagai", right: "Paterson's Gundagai Vineyard", type: "GI-Producer" },
            { left: "Southern New South Wales", right: "Hilltops", type: "Zone-GI" },
            { left: "Hilltops", right: "N/A", type: "GI-Feature" },
            { left: "Hilltops", right: "Chalkers Crossing", type: "GI-Producer" },
            { left: "Hilltops", right: "Grove Estate", type: "GI-Producer" },
            { left: "Hilltops", right: "Barwang Vineyard", type: "GI-Producer" },
            { left: "Southern New South Wales", right: "Tumbarumba", type: "Zone-GI" },
            { left: "Tumbarumba", right: "Snowy Mountains", type: "GI-Feature" },
            { left: "Tumbarumba", right: "Tumbarumba Wine Estates", type: "GI-Producer" },
            { left: "Tumbarumba", right: "Excelsior Peak", type: "GI-Producer" },
            { left: "South Coast", right: "Shoalhaven Coast", type: "Zone-GI" },
            { left: "Shoalhaven Coast", right: "Pacific Ocean", type: "GI-Feature" },
            { left: "Shoalhaven Coast", right: "Cambewarra Estate", type: "GI-Producer" },
            { left: "Shoalhaven Coast", right: "Coolangatta Estate", type: "GI-Producer" },
            { left: "South Coast", right: "Southern Highlands", type: "Zone-GI" },
            { left: "Southern Highlands", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Southern Highlands", right: "Centennial Vineyards", type: "GI-Producer" },
            { left: "Southern Highlands", right: "Cuttaway Hill Estate", type: "GI-Producer" },
            { left: "Big Rivers", right: "Murray Darling", type: "Zone-GI" },
            { left: "Murray Darling", right: "Murray River", type: "GI-Feature" },
            { left: "Murray Darling", right: "Lindemans (Karadoc)", type: "GI-Producer" },
            { left: "Murray Darling", right: "Zilzie Wines", type: "GI-Producer" },
            { left: "Murray Darling", right: "Deakin Estate", type: "GI-Producer" },
            { left: "Big Rivers", right: "Perricoota", type: "Zone-GI" },
            { left: "Perricoota", right: "Murray River", type: "GI-Feature" },
            { left: "Perricoota", right: "St. Anne's Vineyards", type: "GI-Producer" },
            { left: "Big Rivers", right: "Riverina", type: "Zone-GI" },
            { left: "Riverina", right: "The Riverina Plain", type: "GI-Feature" },
            { left: "Riverina", right: "Murrumbidgee River", type: "GI-Feature" },
            { left: "Riverina", right: "De Bortoli", type: "GI-Producer" },
            { left: "Riverina", right: "Casella Wines (Yellow Tail)", type: "GI-Producer" },
            { left: "Riverina", right: "McWilliam's", type: "GI-Producer" },
            { left: "Big Rivers", right: "Swan Hill", type: "Zone-GI" },
            { left: "Swan Hill", right: "Murray River", type: "GI-Feature" },
            { left: "Swan Hill", right: "Andrew Peace Wines", type: "GI-Producer" },
            { left: "Swan Hill", right: "Buller Wines", type: "GI-Producer" },

            // --- Queensland (Logic Update) ---
            { left: "Queensland", right: "N/A", type: "State-Zone" },
            { left: "Queensland-N/A", right: "Granite Belt", type: "Zone-GI" },
            { left: "Queensland-N/A", right: "South Burnett", type: "Zone-GI" },
            { left: "Granite Belt", right: "The Granite Belt", type: "GI-Feature" },
            { left: "Granite Belt", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Granite Belt", right: "Robert Channon", type: "GI-Producer" },
            { left: "Granite Belt", right: "Boireann", type: "GI-Producer" },
            { left: "Granite Belt", right: "Ballandean Estate", type: "GI-Producer" },
            { left: "Granite Belt", right: "Summit Estate", type: "GI-Producer" },
            { left: "South Burnett", right: "Blackbutt Range", type: "GI-Feature" },
            { left: "South Burnett", right: "Brisbane Range", type: "GI-Feature" },
            { left: "South Burnett", right: "Coast Range", type: "GI-Feature" },
            { left: "South Burnett", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "South Burnett", right: "Burnett River", type: "GI-Feature" },
            { left: "South Burnett", right: "Clovely Estate", type: "GI-Producer" },
            { left: "South Burnett", right: "Lightning Tree Wines", type: "GI-Producer" },
            { left: "South Burnett", right: "Kingsley Grove Estate", type: "GI-Producer" },

            // --- South Australia ---
            { left: "South Australia", right: "Far North", type: "State-Zone" },
            { left: "South Australia", right: "The Peninsulas", type: "State-Zone" },
            { left: "South Australia", right: "Mount Lofty Ranges", type: "State-Zone" },
            { left: "South Australia", right: "Barossa", type: "State-Zone" },
            { left: "South Australia", right: "Lower Murray", type: "State-Zone" },
            { left: "South Australia", right: "Fleurieu", type: "State-Zone" },
            { left: "South Australia", right: "Limestone Coast", type: "State-Zone" },
            { left: "Far North", right: "Southern Flinders Ranges", type: "Zone-GI" },
            { left: "Southern Flinders Ranges", right: "Flinders Ranges", type: "GI-Feature" },
            { left: "Southern Flinders Ranges", right: "Spencer Gulf", type: "GI-Feature" },
            { left: "Southern Flinders Ranges", right: "Bundaleer Wines", type: "GI-Producer" },
            { left: "Southern Flinders Ranges", right: "Springton Cellars", type: "GI-Producer" },
            { left: "Mount Lofty Ranges", right: "Clare Valley", type: "Zone-GI" },
            { left: "Clare Valley", right: "Mount Lofty Ranges", type: "GI-Feature" },
            { left: "Clare Valley", right: "Grosset", type: "GI-Producer" },
            { left: "Clare Valley", right: "Kilikanoon", type: "GI-Producer" },
            { left: "Clare Valley", right: "Jim Barry", type: "GI-Producer" },
            { left: "Clare Valley", right: "Taylors", type: "GI-Producer" },
            { left: "Clare Valley", right: "Wendouree", type: "GI-Producer" },
            { left: "Clare Valley", right: "Sevenhill Cellars", type: "GI-Producer" },
            { left: "Mount Lofty Ranges", right: "Adelaide Hills", type: "Zone-GI" },
            { left: "Adelaide Hills", right: "South Mount Lofty Ranges", type: "GI-Feature" },
            { left: "Adelaide Hills", right: "Petaluma", type: "GI-Producer" },
            { left: "Adelaide Hills", right: "Shaw + Smith", type: "GI-Producer" },
            { left: "Adelaide Hills", right: "the Lane", type: "GI-Producer" },
            { left: "Adelaide Hills", right: "Ashton Hills", type: "GI-Producer" },
            { left: "Adelaide Hills", right: "BK Wines", type: "GI-Producer" },
            { left: "Mount Lofty Ranges", right: "Adelaide Plains", type: "Zone-GI" },
            { left: "Adelaide Plains", right: "Gulf of Saint Vincent", type: "GI-Feature" },
            { left: "Adelaide Plains", right: "Primo Estate", type: "GI-Producer" },
            { left: "Adelaide Plains", right: "Ceravolo Estate", type: "GI-Producer" },
            { left: "Adelaide Plains", right: "Penfolds (Magill Estate)", type: "GI-Producer" },
            { left: "Barossa", right: "Barossa Valley", type: "Zone-GI" },
            { left: "Barossa Valley", right: "Barossa Ranges", type: "GI-Feature" },
            { left: "Barossa Valley", right: "Seppeltsfield", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Torbreck", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Peter Lehmann", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Penfolds", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Two Hands", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Wolf Blass", type: "GI-Producer" },
            { left: "Barossa Valley", right: "Turkey Flat", type: "GI-Producer" },
            { left: "Barossa", right: "Eden Valley", type: "Zone-GI" },
            { left: "Eden Valley", right: "Barossa Ranges", type: "GI-Feature" },
            { left: "Eden Valley", right: "Henschke", type: "GI-Producer" },
            { left: "Eden Valley", right: "Pewsey Vale", type: "GI-Producer" },
            { left: "Eden Valley", right: "Yalumba", type: "GI-Producer" },
            { left: "Eden Valley", right: "Mountadam", type: "GI-Producer" },
            { left: "Lower Murray", right: "Riverland", type: "Zone-GI" },
            { left: "Riverland", right: "Murray River", type: "GI-Feature" },
            { left: "Riverland", right: "Oxford Landing", type: "GI-Producer" },
            { left: "Riverland", right: "Banrock Station", type: "GI-Producer" },
            { left: "Riverland", right: "Kingston Estate", type: "GI-Producer" },
            { left: "Fleurieu", right: "McLaren Vale", type: "Zone-GI" },
            { left: "McLaren Vale", right: "Gulf of Saint Vincent", type: "GI-Feature" },
            { left: "McLaren Vale", right: "Adelaide Hills", type: "GI-Feature" },
            { left: "McLaren Vale", right: "Chapel Hill", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Clarendon Hills", type: "GI-Producer" },
            { left: "McLaren Vale", right: "d'Arenberg", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Pirramimma", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Rosemount Estate", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Wirra Wirra", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Kay Bros. Amery", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Mitolo", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Yangarra", type: "GI-Producer" },
            { left: "McLaren Vale", right: "Hickinbotham", type: "GI-Producer" },
            { left: "Fleurieu", right: "Langhorne Creek", type: "Zone-GI" },
            { left: "Langhorne Creek", right: "Lake Alexandrina", type: "GI-Feature" },
            { left: "Langhorne Creek", right: "Bremer River", type: "GI-Feature" },
            { left: "Langhorne Creek", right: "Angas River", type: "GI-Feature" },
            { left: "Langhorne Creek", right: "Bremerton Wines", type: "GI-Producer" },
            { left: "Langhorne Creek", right: "Bleasdale Vineyards", type: "GI-Producer" },
            { left: "Langhorne Creek", right: "Temple Bruer", type: "GI-Producer" },
            { left: "Fleurieu", right: "Currency Creek", type: "Zone-GI" },
            { left: "Currency Creek", right: "Murray River (mouth)", type: "GI-Feature" },
            { left: "Currency Creek", right: "Lake Alexandrina", type: "GI-Feature" },
            { left: "Currency Creek", right: "Encounter Bay", type: "GI-Feature" },
            { left: "Currency Creek", right: "Currency Creek Estate", type: "GI-Producer" },
            { left: "Currency Creek", right: "Stonemason", type: "GI-Producer" },
            { left: "Fleurieu", right: "Kangaroo Island", type: "Zone-GI" },
            { left: "Kangaroo Island", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Kangaroo Island", right: "Islander Estate", type: "GI-Producer" },
            { left: "Kangaroo Island", right: "Cape d'Estaing", type: "GI-Producer" },
            { left: "Fleurieu", right: "Southern Fleurieu", type: "Zone-GI" },
            { left: "Southern Fleurieu", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Southern Fleurieu", right: "Gulf of St. Vincent", type: "GI-Feature" },
            { left: "Southern Fleurieu", right: "Parri Estate", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Coonawarra", type: "Zone-GI" },
            { left: "Coonawarra", right: "none", type: "GI-Feature" },
            { left: "Coonawarra", right: "Majella", type: "GI-Producer" },
            { left: "Coonawarra", right: "Penley Estate", type: "GI-Producer" },
            { left: "Coonawarra", right: "Balnaves of Coonawarra", type: "GI-Producer" },
            { left: "Coonawarra", right: "Wynns Coonawarra Estate", type: "GI-Producer" },
            { left: "Coonawarra", right: "Zema Estate", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Padthaway", type: "Zone-GI" },
            { left: "Padthaway", right: "N/A", type: "GI-Feature" },
            { left: "Padthaway", right: "Padthaway Estate", type: "GI-Producer" },
            { left: "Padthaway", right: "Stonehaven", type: "GI-Producer" },
            { left: "Padthaway", right: "Browns of Padthaway", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Mount Benson", type: "Zone-GI" },
            { left: "Mount Benson", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Mount Benson", right: "Cape Jaffa", type: "GI-Producer" },
            { left: "Mount Benson", right: "Norfolk Rise Vineyard", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Robe", type: "Zone-GI" },
            { left: "Robe", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Robe", right: "Lake George", type: "GI-Feature" },
            { left: "Robe", right: "Lake Eliza", type: "GI-Feature" },
            { left: "Robe", right: "Lake St. Clair", type: "GI-Feature" },
            { left: "Robe", right: "N/A", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Wrattonbully", type: "Zone-GI" },
            { left: "Wrattonbully", right: "Stewarts Range", type: "GI-Feature" },
            { left: "Wrattonbully", right: "Naracoorte Range", type: "GI-Feature" },
            { left: "Wrattonbully", right: "Caves Range", type: "GI-Feature" },
            { left: "Wrattonbully", right: "Hynam Range", type: "GI-Feature" },
            { left: "Wrattonbully", right: "World Heritage Naracoorte Caves", type: "GI-Feature" },
            { left: "Wrattonbully", right: "Tapanappa", type: "GI-Producer" },
            { left: "Limestone Coast", right: "Mount Gambier", type: "Zone-GI" },
            { left: "Mount Gambier", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Mount Gambier", right: "Caroline Hills", type: "GI-Producer" },
            
            // --- Tasmania (Logic Update) ---
            { left: "Tasmania", right: "N/A", type: "State-Zone" },
            { left: "Tasmania-N/A", right: "Tasmania", type: "Zone-GI" },
            { left: "Tasmania", right: "N/A", type: "GI-Feature" },
            { left: "Tasmania", right: "Pipers Brook Vineyard", type: "GI-Producer" },
            { left: "Tasmania", right: "Tamar Ridge", type: "GI-Producer" },
            { left: "Tasmania", right: "Jansz", type: "GI-Producer" },
            { left: "Tasmania", right: "Bay of Fires/House of Arras", type: "GI-Producer" },
            { left: "Tasmania", right: "Rosevears Estate", type: "GI-Producer" },
            { left: "Tasmania", right: "Domaine A", type: "GI-Producer" },
            { left: "Tasmania", right: "Elsewhere Vineyard", type: "GI-Producer" },
            { left: "Tasmania", right: "Stefano Lubiana", type: "GI-Producer" },

            // --- Victoria ---
            { left: "Victoria", right: "North West Victoria", type: "State-Zone" },
            { left: "Victoria", right: "Western Victoria", type: "State-Zone" },
            { left: "Victoria", right: "Central Victoria", type: "State-Zone" },
            { left: "Victoria", right: "Port Phillip", type: "State-Zone" },
            { left: "Victoria", right: "North East Victoria", type: "State-Zone" },
            { left: "Victoria", right: "Gippsland", type: "State-Zone" },
            { left: "North West Victoria", right: "Murray Darling", type: "Zone-GI" },
            { left: "North West Victoria", right: "Swan Hill", type: "Zone-GI" },
            { left: "Western Victoria", right: "Grampians", type: "Zone-GI" },
            { left: "Grampians", right: "Grampians National Park", type: "GI-Feature" },
            { left: "Grampians", right: "Best's Wines", type: "GI-Producer" },
            { left: "Grampians", right: "Grampians Estate", type: "GI-Producer" },
            { left: "Grampians", right: "Seppelt Great Western", type: "GI-Producer" },
            { left: "Grampians", right: "Mount Langi Ghiran Vineyards", type: "GI-Producer" },
            { left: "Western Victoria", right: "Henty", type: "Zone-GI" },
            { left: "Henty", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Henty", right: "Seppelt (Drumborg)", type: "GI-Producer" },
            { left: "Henty", right: "Tarrington Vineyards", type: "GI-Producer" },
            { left: "Henty", right: "Crawford River", type: "GI-Producer" },
            { left: "Henty", right: "Bochara Wines", type: "GI-Producer" },
            { left: "Western Victoria", right: "Pyrenees", type: "Zone-GI" },
            { left: "Pyrenees", right: "Pyrenees Range", type: "GI-Feature" },
            { left: "Pyrenees", right: "Blue Pyrenees Estate", type: "GI-Producer" },
            { left: "Pyrenees", right: "Dalwhinnie", type: "GI-Producer" },
            { left: "Pyrenees", right: "Summerfield", type: "GI-Producer" },
            { left: "Central Victoria", right: "Bendigo", type: "Zone-GI" },
            { left: "Bendigo", right: "None", type: "GI-Feature" },
            { left: "Bendigo", right: "Balgownie Estate", type: "GI-Producer" },
            { left: "Central Victoria", right: "Goulburn Valley", type: "Zone-GI" },
            { left: "Goulburn Valley", right: "Goulburn River", type: "GI-Feature" },
            { left: "Goulburn Valley", right: "Tahbilk", type: "GI-Producer" },
            { left: "Goulburn Valley", right: "Monichino Wines", type: "GI-Producer" },
            { left: "Central Victoria", right: "Heathcote", type: "Zone-GI" },
            { left: "Heathcote", right: "Mt. Camel Range", type: "GI-Feature" },
            { left: "Heathcote", right: "Jasper Hill", type: "GI-Producer" },
            { left: "Heathcote", right: "Domaines Tatiarra", type: "GI-Producer" },
            { left: "Heathcote", right: "Heathcote Winery", type: "GI-Producer" },
            { left: "Central Victoria", right: "Strathbogie Ranges", type: "Zone-GI" },
            { left: "Strathbogie Ranges", right: "Strathbogie Ranges", type: "GI-Feature" },
            { left: "Strathbogie Ranges", right: "Plunkett", type: "GI-Producer" },
            { left: "Strathbogie Ranges", right: "Dominion Wines", type: "GI-Producer" },
            { left: "Central Victoria", right: "Upper Goulburn", type: "Zone-GI" },
            { left: "Upper Goulburn", right: "Goulburn River", type: "GI-Feature" },
            { left: "Upper Goulburn", right: "Lake Eildon", type: "GI-Feature" },
            { left: "Upper Goulburn", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Upper Goulburn", right: "Delatite", type: "GI-Producer" },
            { left: "Gippsland", right: "Gippsland", type: "Zone-GI" }, // This is a Zone that is also a GI
            { left: "Gippsland", right: "Bass Strait/Southern Ocean", type: "GI-Feature" },
            { left: "Gippsland", right: "Great Dividing Range", type: "GI-Feature" },
            { left: "Gippsland", right: "Bass Phillip", type: "GI-Producer" },
            { left: "Gippsland", right: "Caledonia Australis", type: "GI-Producer" },
            { left: "North East Victoria", right: "Alpine Valleys", type: "Zone-GI" },
            { left: "Alpine Valleys", right: "Victorian Alps", type: "GI-Feature" },
            { left: "Alpine Valleys", right: "Gapsted Wines (Victorian Alps Wine Co.)", type: "GI-Producer" },
            { left: "North East Victoria", right: "Beechworth", type: "Zone-GI" },
            { left: "Beechworth", right: "Victorian Alps", type: "GI-Feature" },
            { left: "Beechworth", right: "Giaconda", type: "GI-Producer" },
            { left: "Beechworth", right: "Sorrenberg", type: "GI-Producer" },
            { left: "Beechworth", right: "Castagna Vineyard", type: "GI-Producer" },
            { left: "Beechworth", right: "Golden Ball", type: "GI-Producer" },
            { left: "North East Victoria", right: "Glenrowan", type: "Zone-GI" },
            { left: "Glenrowan", right: "Warby Ranges", type: "GI-Feature" },
            { left: "Glenrowan", right: "Lake Mokoan", type: "GI-Feature" },
            { left: "Glenrowan", right: "Baileys of Glenrowan", type: "GI-Producer" },
            { left: "Glenrowan", right: "Goorambath", type: "GI-Producer" },
            { left: "Glenrowan", right: "Judds Warby Range Estate", type: "GI-Producer" },
            { left: "North East Victoria", right: "King Valley", type: "Zone-GI" },
            { left: "King Valley", right: "King River", type: "GI-Feature" },
            { left: "King Valley", right: "Oxley Plains", type: "GI-Feature" },
            { left: "King Valley", right: "Victorian Alps", type: "GI-Feature" },
            { left: "King Valley", right: "Brown Brothers", type: "GI-Producer" },
            { left: "North East Victoria", right: "Rutherglen", type: "Zone-GI" },
            { left: "Rutherglen", right: "Murray River", type: "GI-Feature" },
            { left: "Rutherglen", right: "Victorian Alps", type: "GI-Feature" },
            { left: "Rutherglen", right: "Campbells", type: "GI-Producer" },
            { left: "Rutherglen", right: "Chambers", type: "GI-Producer" },
            { left: "Rutherglen", right: "All Saints", type: "GI-Producer" },
            { left: "Rutherglen", right: "Morris", type: "GI-Producer" },
            { left: "Rutherglen", right: "Pfeiffer", type: "GI-Producer" },
            { left: "Rutherglen", right: "Stanton & Killeen", type: "GI-Producer" },
            { left: "Port Phillip", right: "Geelong", type: "Zone-GI" },
            { left: "Geelong", right: "Port Phillip Bay", type: "GI-Feature" },
            { left: "Geelong", right: "Bass Strait", type: "GI-Feature" },
            { left: "Geelong", right: "Moorabool River", type: "GI-Feature" },
            { left: "Geelong", right: "Leigh River", type: "GI-Feature" },
            { left: "Geelong", right: "Barwon River", type: "GI-Feature" },
            { left: "Geelong", right: "Shadowfax", type: "GI-Producer" },
            { left: "Geelong", right: "By Farr", type: "GI-Producer" },
            { left: "Geelong", right: "Bannockburn", type: "GI-Producer" },
            { left: "Geelong", right: "Austins Wines", type: "GI-Producer" },
            { left: "Port Phillip", right: "Macedon Ranges", type: "Zone-GI" },
            { left: "Macedon Ranges", right: "Macedon Range", type: "GI-Feature" },
            { left: "Macedon Ranges", right: "Bindi", type: "GI-Producer" },
            { left: "Macedon Ranges", right: "Curly Flat", type: "GI-Producer" },
            { left: "Macedon Ranges", right: "Hanging Rock", type: "GI-Producer" },
            { left: "Macedon Ranges", right: "Granite Hills", type: "GI-Producer" },
            { left: "Port Phillip", right: "Mornington Peninsula", type: "Zone-GI" },
            { left: "Mornington Peninsula", right: "Bass Strait", type: "GI-Feature" },
            { left: "Mornington Peninsula", right: "Port Phillip Bay", type: "GI-Feature" },
            { left: "Mornington Peninsula", right: "Western Port Bay", type: "GI-Feature" },
            { left: "Mornington Peninsula", right: "Main Ridge Estate", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Willow Creek Vineyard", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Kooyong", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Paringa Estate", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Stonier Wines", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Yabby Lake", type: "GI-Producer" },
            { left: "Mornington Peninsula", right: "Ocean Eight", type: "GI-Producer" },
            { left: "Port Phillip", right: "Sunbury", type: "Zone-GI" },
            { left: "Sunbury", right: "Macedon Ranges", type: "GI-Feature" },
            { left: "Sunbury", right: "Port Phillip Bay", type: "GI-Feature" },
            { left: "Sunbury", right: "Craiglee", type: "GI-Producer" },
            { left: "Sunbury", right: "Goona Warra Vineyard", type: "GI-Producer" },
            { left: "Port Phillip", right: "Yarra Valley", type: "Zone-GI" },
            { left: "Yarra Valley", right: "Yarra Ranges/Great Dividing Range", type: "GI-Feature" },
            { left: "Yarra Valley", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Yarra Valley", right: "Yering Station", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Yarra Yering", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Mount Mary", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Domaine Chandon", type: "GI-Producer" },
            { left: "Yarra Valley", right: "De Bortoli", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Yarra Yarra", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Coldstream Hills", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Oakridge", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Giant Steps", type: "GI-Producer" },
            { left: "Yarra Valley", right: "Mac Forbes", type: "GI-Producer" },

            // --- Western Australia ---
            { left: "Western Australia", right: "South West Australia", type: "State-Zone" },
            { left: "Western Australia", right: "Greater Perth", type: "State-Zone" },
            { left: "Western Australia", right: "Central Western Australia", type: "State-Zone" },
            { left: "Western Australia", right: "West Australian South East Coastal", type: "State-Zone" },
            { left: "Western Australia", right: "Eastern Plains, Inland & North of Western Australia", type: "State-Zone" },
            { left: "South West Australia", right: "Margaret River", type: "Zone-GI" },
            { left: "Margaret River", right: "Leeuwin-Naturaliste Ridge", type: "GI-Feature" },
            { left: "Margaret River", right: "Indian Ocean", type: "GI-Feature" },
            { left: "Margaret River", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Margaret River", right: "Geographe Bay", type: "GI-Feature" },
            { left: "Margaret River", right: "Leeuwin Estate", type: "GI-Producer" },
            { left: "Margaret River", right: "Cullen", type: "GI-Producer" },
            { left: "Margaret River", right: "Cape Mentelle", type: "GI-Producer" },
            { left: "Margaret River", right: "Vasse Felix", type: "GI-Producer" },
            { left: "Margaret River", right: "Moss Wood", type: "GI-Producer" },
            { left: "South West Australia", right: "Geographe", type: "Zone-GI" },
            { left: "Geographe", right: "Geographe Bay/Indian Ocean", type: "GI-Feature" },
            { left: "Geographe", right: "Darling Range", type: "GI-Feature" },
            { left: "Geographe", right: "Whicher Range", type: "GI-Feature" },
            { left: "Geographe", right: "Capel Vale", type: "GI-Producer" },
            { left: "Geographe", right: "Willow Bridge Estate", type: "GI-Producer" },
            { left: "South West Australia", right: "Blackwood Valley", type: "Zone-GI" },
            { left: "Blackwood Valley", right: "Darling Plateau", type: "GI-Feature" },
            { left: "Blackwood Valley", right: "Blackwood Crest", type: "GI-Producer" },
            { left: "South West Australia", right: "Manjimup", type: "Zone-GI" },
            { left: "Manjimup", right: "Warren River Valley", type: "GI-Feature" },
            { left: "Manjimup", right: "Peos Estate", type: "GI-Producer" },
            { left: "Manjimup", right: "Yanmah Ridge", type: "GI-Producer" },
            { left: "South West Australia", right: "Pemberton", type: "Zone-GI" },
            { left: "Pemberton", right: "Warren River", type: "GI-Feature" },
            { left: "Pemberton", right: "Donnelly River", type: "GI-Feature" },
            { left: "Pemberton", right: "Salitage", type: "GI-Producer" },
            { left: "South West Australia", right: "Great Southern", type: "Zone-GI" },
            { left: "Great Southern", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Great Southern", right: "Denmark", type: "Zone-GI" }, 
            { left: "Denmark", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Denmark", right: "Singlefile Estate", type: "GI-Producer" },
            { left: "Denmark", right: "Harewood Estate", type: "GI-Producer" },
            { left: "Denmark", right: "Moombaki", type: "GI-Producer" },
            { left: "Denmark", right: "Howard Park", type: "GI-Producer" },
            { left: "Denmark", right: "Yilgarnia", type: "GI-Producer" },
            { left: "Great Southern", right: "Albany", type: "Zone-GI" },
            { left: "Albany", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Albany", right: "Montgomery's Hill", type: "GI-Producer" },
            { left: "Albany", right: "Wignalls Wines", type: "GI-Producer" },
            { left: "Albany", right: "Two People's Bay Wines", type: "GI-Producer" },
            { left: "Great Southern", right: "Porongurup", type: "Zone-GI" },
            { left: "Porongurup", right: "Porongurups Range", type: "GI-Feature" },
            { left: "Porongurup", right: "Castle Rock Estate", type: "GI-Producer" },
            { left: "Porongurup", right: "Gibraltar Rock", type: "GI-Producer" },
            { left: "Great Southern", right: "Frankland River", type: "Zone-GI" },
            { left: "Frankland River", right: "Southern Ocean", type: "GI-Feature" },
            { left: "Frankland River", right: "Alkoomi", type: "GI-Producer" },
            { left: "Frankland River", right: "Ferngrove Vineyards", type: "GI-Producer" },
            { left: "Frankland River", right: "Frankland Estate", type: "GI-Producer" },
            { left: "Great Southern", right: "Mount Barker", type: "Zone-GI" },
            { left: "Mount Barker", right: "Plantagenet Plateau", type: "GI-Feature" },
            { left: "Mount Barker", right: "Mount Barker Hill", type: "GI-Feature" },
            { left: "Mount Barker", right: "Forest Hill Vineyard", type: "GI-Producer" },
            { left: "Mount Barker", right: "Plantagenet", type: "GI-Producer" },
            { left: "Greater Perth", right: "Peel", type: "Zone-GI" },
            { left: "Greater Perth", right: "Perth Hills", type: "Zone-GI" },
            { left: "Greater Perth", right: "Swan District", type: "Zone-GI" },
            { left: "Peel", right: "N/A", type: "GI-Feature" },
            { left: "Peel", right: "N/A", type: "GI-Producer" },
            { left: "Perth Hills", right: "N/A", type: "GI-Feature" },
            { left: "Perth Hills", right: "N/A", type: "GI-Producer" },
            { left: "Swan District", right: "N/A", type: "GI-Feature" },
            { left: "Swan District", right: "N/A", type: "GI-Producer" },
        ];

        // --- Create specialized data arrays ---
        const stateZonePairs = gameData.filter(q => q.type === 'State-Zone');
        const zoneGIPairs = gameData.filter(q => q.type === 'Zone-GI');
        const giFeaturePairs = gameData.filter(q => q.type === 'GI-Feature' && q.right !== 'N/A' && q.right !== 'none');
        const giProducerPairs = gameData.filter(q => q.type === 'GI-Producer' && q.right !== 'N/A');

        const positiveMessages = ["Great job!", "Good work.", "What a pro!", "Awesome!", "You're on a roll!", "Magnifique!", "Superb!"];
        const TOTAL_ROUNDS = 10;

        // --- GAME STATE ---
        let score = 0;
        let currentRound = 1;
        let currentGameMode = '';
        let gameRounds = []; // This will be an array of 10 arrays (each inner array has 5 pairs)
        let currentRoundPairs = []; // The 5 pairs for the current round
        let leftToRightPairs = new Map(); // Stores all correct matches, e.g. "NSW" -> Set("Hunter", "Big Rivers")
        let itemAttempts = new Map(); // Tracks attempts per *button*, e.g. "left-0" -> 1
        let matchesMade = 0;
        let selectedLeft = null;  // Will store the button element
        let selectedRight = null; // Will store the button element

        // --- FLASHCARD STATE ---
        const flashcardDecks = {
            'State-Zone': [],
            'Zone-GI': [],
            'GI-Feature': [],
            'GI-Producer': []
        };
        let currentFlashcardDeck = [];
        let currentFilteredDeck = [];
        let currentCardIndex = 0;
        let isCardFlipped = false;
        
        // --- DOM ELEMENTS ---
        const gameContainer = document.getElementById('game-container');
        const startModal = document.getElementById('start-modal');
        const startGameBtns = document.querySelectorAll('.start-game-btn');
        const scoreInfo = document.getElementById('score-info');
        const roundInfo = document.getElementById('round-info');
        const roundPrompt = document.getElementById('round-prompt');
        const leftTitle = document.getElementById('left-title');
        const rightTitle = document.getElementById('right-title');
        const gameRowsContainer = document.getElementById('game-rows-container');
        const successModal = document.getElementById('success-modal');
        const gameOverModal = document.getElementById('game-over-modal');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const gameMainMenuBtn = document.getElementById('game-main-menu-btn');
        // DB Elements
        const exploreDataBtn = document.getElementById('explore-data-btn');
        const databaseModal = document.getElementById('database-modal');
        const closeDbBtn = document.getElementById('close-db-btn');
        const databaseContainer = document.getElementById('database-container');
        // Flashcard Elements
        const flashcardsBtn = document.getElementById('flashcards-btn');
        const flashcardMenuModal = document.getElementById('flashcard-menu-modal');
        const flashcardMenuBackBtn = document.getElementById('flashcard-menu-back-btn');
        const startFlashcardsBtns = document.querySelectorAll('.start-flashcards-btn');
        const flashcardContainer = document.getElementById('flashcard-container');
        const flashcardMainMenuBtn = document.getElementById('flashcard-main-menu-btn');
        const flashcardDeckTitle = document.getElementById('flashcard-deck-title');
        const studyModeRadios = document.querySelectorAll('.study-mode-radio');
        const resetDeckBtn = document.getElementById('reset-deck-btn');
        const flashcard = document.getElementById('flashcard');
        const flashcardFront = document.getElementById('flashcard-front');
        const flashcardBack = document.getElementById('flashcard-back');
        const flashcardStatus = document.getElementById('flashcard-status');
        const flashcardEmptyDeckMsg = document.getElementById('flashcard-empty-deck-msg');
        const prevCardBtn = document.getElementById('prev-card-btn');
        const nextCardBtn = document.getElementById('next-card-btn');
        const toggleLearnedBtn = document.getElementById('toggle-learned-btn');


        // --- Database JSON Generation ---
        const databaseJSON = {};

        function processDatabase() {
            // Clear database to prevent duplicates on re-processing
            for (const key in databaseJSON) {
                delete databaseJSON[key];
            }

            gameData.forEach(item => {
                const { left, right, type } = item;
                
                if (type === 'State-Zone') {
                    if (!databaseJSON[left]) databaseJSON[left] = { zones: {} };
                    if (!databaseJSON[left].zones[right]) databaseJSON[left].zones[right] = { gis: {} };
                } 
                else if (type === 'Zone-GI') {
                    let stateName = null;
                    let zoneName = left;

                    if (left.includes("-N/A")) {
                        stateName = left.split("-N/A")[0];
                        zoneName = "N/A";
                    } else {
                        // Find which state this zone belongs to
                        for (const state in databaseJSON) {
                            if (databaseJSON[state].zones[left]) {
                                stateName = state;
                                break;
                            }
                        }
                    }

                    if (stateName && databaseJSON[stateName] && databaseJSON[stateName].zones[zoneName]) {
                        if (!databaseJSON[stateName].zones[zoneName].gis[right]) {
                            databaseJSON[stateName].zones[zoneName].gis[right] = { features: new Set(), producers: new Set() };
                        }
                    }
                } 
                else if (type === 'GI-Feature' && right !== 'N/A' && right !== 'none') {
                    for (const state in databaseJSON) {
                        for (const zone in databaseJSON[state].zones) {
                            if (databaseJSON[state].zones[zone].gis[left]) {
                                databaseJSON[state].zones[zone].gis[left].features.add(right);
                            }
                        }
                    }
                } 
                else if (type === 'GI-Producer' && right !== 'N/A') {
                    for (const state in databaseJSON) {
                        for (const zone in databaseJSON[state].zones) {
                            if (databaseJSON[state].zones[zone].gis[left]) {
                                databaseJSON[state].zones[zone].gis[left].producers.add(right);
                            }
                        }
                    }
                }
            });

            // Special handling for GIs with no features/producers listed
            for (const state in databaseJSON) {
                for (const zone in databaseJSON[state].zones) {
                    for (const gi in databaseJSON[state].zones[zone].gis) {
                        const giData = databaseJSON[state].zones[zone].gis[gi];
                        if (giData.features.size === 0) giData.features.add("N/A");
                        if (giData.producers.size === 0) giData.producers.add("N/A");
                    }
                }
            }
        }

        // --- Database HTML Builder ---
        function buildDatabaseExplorer() {
            databaseContainer.innerHTML = ''; // Clear old data
            const states = Object.keys(databaseJSON).sort();
            
            states.forEach(state => {
                const stateData = databaseJSON[state];
                const stateId = `db-state-${state.replace(/\s/g, '')}`;
                
                const stateDiv = document.createElement('div');
                stateDiv.innerHTML = `<div class="db-item db-state" data-target="${stateId}">${state}</div>`;
                
                const zoneContainer = document.createElement('div');
                zoneContainer.id = stateId;
                zoneContainer.className = 'db-item-content space-y-2 py-2';

                const zones = Object.keys(stateData.zones).sort();
                zones.forEach(zone => {
                    const zoneData = stateData.zones[zone];
                    const giCount = Object.keys(zoneData.gis).length;
                    const zoneId = `db-zone-${state.replace(/\s/g, '')}-${zone.replace(/\s/g, '')}`;

                    if (giCount > 0) {
                        const zoneDiv = document.createElement('div');
                        zoneDiv.innerHTML = `<div class="db-item db-zone" data-target="${zoneId}">${zone}</div>`;
                        
                        const giContainer = document.createElement('div');
                        giContainer.id = zoneId;
                        giContainer.className = 'db-item-content space-y-2 py-2';

                        const gisInZone = Object.keys(zoneData.gis).sort();
                        gisInZone.forEach(gi => {
                            const giData = zoneData.gis[gi];
                            const giId = `db-gi-${state.replace(/\s/g, '')}-${zone.replace(/\s/g, '')}-${gi.replace(/\s/g, '').replace(/[\(\)]/g, '')}`;
                            
                            const giDiv = document.createElement('div');
                            giDiv.innerHTML = `<div class="db-item db-gi" data-target="${giId}">${gi}</div>`;
                            
                            const detailsContainer = document.createElement('div');
                            detailsContainer.id = giId;
                            detailsContainer.className = 'db-item-content py-2';
                            
                            let detailsHtml = '<div class="db-gi-details">';
                            
                            // Add Features
                            detailsHtml += '<h5>Major Natural Features:</h5><ul>';
                            Array.from(giData.features).sort().forEach(f => detailsHtml += `<li>${f}</li>`);
                            detailsHtml += '</ul>';
                            
                            // Add Producers
                            detailsHtml += '<h5>Key Producers:</h5><ul>';
                            Array.from(giData.producers).sort().forEach(p => detailsHtml += `<li>${p}</li>`);
                            detailsHtml += '</ul>';
                            
                            detailsHtml += '</div>';
                            detailsContainer.innerHTML = detailsHtml;

                            giDiv.appendChild(detailsContainer);
                            giContainer.appendChild(giDiv);
                        });
                        
                        zoneDiv.appendChild(giContainer);
                        zoneContainer.appendChild(zoneDiv);
                    } else {
                        // Zone with no GIs (e.g., Western Plains)
                        zoneContainer.innerHTML += `<div class="db-item-no-click db-zone">${zone} (No GIs)</div>`;
                    }
                });

                stateDiv.appendChild(zoneContainer);
                databaseContainer.appendChild(stateDiv);
            });
        }

        // --- Database Event Listener ---
        databaseContainer.addEventListener('click', function(e) {
            const target = e.target.closest('.db-item');
            if (target) {
                const contentId = target.dataset.target;
                if (contentId) {
                    const content = document.getElementById(contentId);
                    content.classList.toggle('expanded');
                    target.classList.toggle('expanded');
                }
            }
        });


        // --- GAME FUNCTIONS ---

        /**
         * Sets up the 10 rounds for the selected game mode
         */
        function buildGameRounds() {
            gameRounds = [];
            let sourcePairs = [];

            if (currentGameMode === 'State-Zone') {
                sourcePairs = [...stateZonePairs];
            } else if (currentGameMode === 'Zone-GI') {
                sourcePairs = [...zoneGIPairs];
            } else if (currentGameMode === 'GI-Feature') {
                sourcePairs = [...giFeaturePairs];
            } else if (currentGameMode === 'GI-Producer') {
                sourcePairs = [...giProducerPairs];
            }

            shuffleArray(sourcePairs);
            
            // Build 10 rounds, 5 pairs each
            for (let i = 0; i < TOTAL_ROUNDS; i++) {
                // Ensure we have enough pairs, looping if necessary
                let roundPairs = [];
                for (let j = 0; j < 5; j++) {
                    roundPairs.push(sourcePairs[(i * 5 + j) % sourcePairs.length]);
                }
                gameRounds.push(roundPairs);
            }
        }

        /**
         * Initializes the game.
         */
        function initGame() {
            score = 0;
            currentRound = 1;
            buildGameRounds(); // Build the 10 rounds for the current mode
            startRound();
        }
        
        /**
         * Starts a new round.
         */
        function startRound() {
            if (currentRound > TOTAL_ROUNDS) {
                showGameOver();
                return;
            }

            // Reset round state
            matchesMade = 0;
            selectedLeft = null;
            selectedRight = null;
            leftToRightPairs.clear();
            itemAttempts.clear();
            
            currentRoundPairs = gameRounds[currentRound - 1];
            const leftItems = [];
            const rightItems = [];
            const pairType = currentRoundPairs[0].type;

            currentRoundPairs.forEach(pair => {
                leftItems.push(pair.left);
                rightItems.push(pair.right);
                
                // Build the flexible matching map
                if (!leftToRightPairs.has(pair.left)) {
                    leftToRightPairs.set(pair.left, new Set());
                }
                leftToRightPairs.get(pair.left).add(pair.right);
            });

            shuffleArray(rightItems); // Shuffle the right column

            updateScoreboard();
            renderButtons(leftItems, rightItems, pairType);
        }

        /**
         * Renders the choice buttons for the current round.
         */
        function renderButtons(leftItems, rightItems, pairType) {
            gameRowsContainer.innerHTML = ''; // Clear old rows
            itemAttempts.clear(); // Clear attempts for new buttons

            // Set titles and prompt based on round type
            switch (pairType) {
                case 'State-Zone':
                    leftTitle.textContent = "State";
                    rightTitle.textContent = "Zone";
                    roundPrompt.textContent = "Match the State to its Zone";
                    break;
                case 'Zone-GI':
                    leftTitle.textContent = "Zone";
                    rightTitle.textContent = "GI";
                    roundPrompt.textContent = "Match the Zone to its GI";
                    break;
                case 'GI-Feature':
                    leftTitle.textContent = "GI";
                    rightTitle.textContent = "Major Natural Feature";
                    roundPrompt.textContent = "Match the GI to its Feature";
                    break;
                case 'GI-Producer':
                    leftTitle.textContent = "GI";
                    rightTitle.textContent = "Key Producer";
                    roundPrompt.textContent = "Match the GI to its Producer";
                    break;
            }

            // Create 5 parallel rows
            for(let i = 0; i < 5; i++) {
                const row = document.createElement('div');
                row.className = 'grid grid-cols-2 gap-4 md:gap-8';

                const leftItem = leftItems[i];
                const rightItem = rightItems[i];

                // Left Button
                const leftButton = document.createElement('button');
                const leftButtonId = `left-${i}`;
                leftButton.textContent = leftItem.includes("-N/A") ? "N/A" : leftItem;
                leftButton.dataset.id = leftButtonId; // Unique ID for this button
                leftButton.dataset.value = leftItem;   // The true value (e.g., "Queensland-N/A")
                leftButton.classList.add('btn-choice', 'p-4', 'rounded-lg', 'font-semibold');
                leftButton.onclick = () => handleLeftClick(leftButton);
                
                itemAttempts.set(leftButtonId, 0); // Track attempts per button

                // Right Button
                const rightButton = document.createElement('button');
                const rightButtonId = `right-${i}`;
                rightButton.textContent = rightItem;
                rightButton.dataset.id = rightButtonId; // Unique ID
                rightButton.dataset.value = rightItem;    // The text value
                rightButton.classList.add('btn-choice', 'p-4', 'rounded-lg', 'font-semibold');
                rightButton.onclick = () => handleRightClick(rightButton);

                row.appendChild(leftButton);
                row.appendChild(rightButton);
                gameRowsContainer.appendChild(row);
            }
        }
        
        /**
         * Handles clicking a button in the left column.
         */
        function handleLeftClick(button) {
            if (button.classList.contains('correct')) return;
            // Deselect other left buttons
            document.querySelectorAll('#game-rows-container .btn-choice[data-id^="left-"]').forEach(btn => btn.classList.remove('selected'));
            
            button.classList.add('selected');
            selectedLeft = button;
            checkMatch();
        }

        /**
         * Handles clicking a button in the right column.
         */
        function handleRightClick(button) {
            if (button.classList.contains('correct')) return;
            // Deselect other right buttons
            document.querySelectorAll('#game-rows-container .btn-choice[data-id^="right-"]').forEach(btn => btn.classList.remove('selected'));

            button.classList.add('selected');
            selectedRight = button;
            checkMatch();
        }

        /**
         * Checks if a match has been made and processes it.
         */
        function checkMatch() {
            if (!selectedLeft || !selectedRight) {
                return; // Waiting for selections from both columns
            }

            const leftBtn = selectedLeft;
            const rightBtn = selectedRight;
            const leftValue = leftBtn.dataset.value;
            const rightValue = rightBtn.dataset.value;
            const leftId = leftBtn.dataset.id;
            
            // Reset selections
            selectedLeft = null;
            selectedRight = null;
            leftBtn.classList.remove('selected');
            rightBtn.classList.remove('selected');

            const isCorrect = leftToRightPairs.get(leftValue)?.has(rightValue);

            if (isCorrect) {
                // --- CORRECT MATCH ---
                matchesMade++;
                const currentAttempts = itemAttempts.get(leftId);
                
                if (currentAttempts === 0) {
                    score += 2; // +2 for first-try match
                } else {
                    score += 1; // +1 for subsequent match
                }

                leftBtn.classList.add('correct');
                rightBtn.classList.add('correct');
                leftBtn.disabled = true;
                rightBtn.disabled = true;

                if (matchesMade === 5) {
                    setTimeout(showSuccessModal, 500);
                }
            } else {
                // --- INCORRECT MATCH ---
                score = Math.max(0, score - 1); // Decrement score
                const currentAttempts = itemAttempts.get(leftId);
                itemAttempts.set(leftId, currentAttempts + 1); 

                leftBtn.classList.add('incorrect');
                rightBtn.classList.add('incorrect');
                setTimeout(() => {
                    leftBtn.classList.remove('incorrect');
                    rightBtn.classList.remove('incorrect');
                }, 500);
            }
            updateScoreboard();
        }

        function updateScoreboard() {
            scoreInfo.textContent = score;
            roundInfo.textContent = `${Math.min(currentRound, TOTAL_ROUNDS)} / ${TOTAL_ROUNDS}`;
        }
        
        function showSuccessModal() {
            const modalMessage = document.getElementById('modal-message');
            const randomMessage = positiveMessages[Math.floor(Math.random() * positiveMessages.length)];
            modalMessage.textContent = randomMessage;
            
            successModal.classList.remove('hidden');
            setTimeout(() => {
                successModal.firstElementChild.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideSuccessModal() {
            successModal.firstElementChild.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                successModal.classList.add('hidden');
                currentRound++;
                startRound();
            }, 200);
        }

        function showGameOver() {
            const finalScoreEl = document.getElementById('final-score');
            const finalPercentageEl = document.getElementById('final-percentage');
            const finalMessageEl = document.getElementById('final-score-message');

            // Max score is 2 points * 5 pairs * 10 rounds
            const maxScore = TOTAL_ROUNDS * 5 * 2;
            const percentage = Math.round(Math.max(0, (score / maxScore) * 100));

            let message = '';
            if (percentage === 100) message = "Perfect Score!";
            else if (percentage >= 90) message = "You're a Master!";
            else if (percentage >= 80) message = "Superb!";
            else if (percentage >= 70) message = "Great work.";
            else if (percentage >= 50) message = "Nicely done!";
            else message = "Keep practicing!";

            finalScoreEl.textContent = score;
            finalPercentageEl.textContent = `${percentage}%`;
            finalMessageEl.textContent = message;
            
            gameOverModal.classList.remove('hidden');
            setTimeout(() => {
                gameOverModal.firstElementChild.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideGameOver() {
            gameOverModal.firstElementChild.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                gameOverModal.classList.add('hidden');
                startModal.classList.remove('hidden'); // Go to main menu
            }, 200);
        }

        // --- FLASHCARD FUNCTIONS ---
        
        function buildFlashcardDecks() {
            // Clear existing decks
            Object.keys(flashcardDecks).forEach(key => flashcardDecks[key] = []);
            
            const uniquePairs = new Map();

            // State-Zone Deck: "What State is [ZONE] in?" -> [STATE]
            uniquePairs.set('State-Zone', new Map());
            gameData.filter(p => p.type === 'State-Zone').forEach(p => {
                uniquePairs.get('State-Zone').set(p.right, p.left); // key=Zone, value=State
            });
            uniquePairs.get('State-Zone').forEach((state, zone) => {
                flashcardDecks['State-Zone'].push({
                    prompt: `What State is this Zone in?`,
                    front: zone,
                    back: state,
                    id: `sz-${zone}`,
                    learned: false
                });
            });

            // Zone-GI Deck: "What Zone is [GI] in?" -> [ZONE]
            uniquePairs.set('Zone-GI', new Map());
            gameData.filter(p => p.type === 'Zone-GI').forEach(p => {
                let zone = p.left.includes("-N/A") ? "N/A" : p.left;
                uniquePairs.get('Zone-GI').set(p.right, zone); // key=GI, value=Zone
            });
            uniquePairs.get('Zone-GI').forEach((zone, gi) => {
                flashcardDecks['Zone-GI'].push({
                    prompt: `What Zone is this GI in?`,
                    front: gi,
                    back: zone,
                    id: `zg-${gi}`,
                    learned: false
                });
            });

            // GI-Feature Deck: "What GI has this feature?" -> [GI]
            uniquePairs.set('GI-Feature', new Map());
            gameData.filter(p => p.type === 'GI-Feature' && p.right !== 'N/A' && p.right !== 'none').forEach(p => {
                if (!uniquePairs.get('GI-Feature').has(p.right)) {
                    uniquePairs.get('GI-Feature').set(p.right, new Set());
                }
                uniquePairs.get('GI-Feature').get(p.right).add(p.left); // key=Feature, value=Set(GIs)
            });
            uniquePairs.get('GI-Feature').forEach((gis, feature) => {
                flashcardDecks['GI-Feature'].push({
                    prompt: `What GI has this feature?`,
                    front: feature,
                    back: Array.from(gis).join(' / '),
                    id: `gf-${feature.replace(/\s/g, '')}`,
                    learned: false
                });
            });

            // GI-Producer Deck: "What GI is [PRODUCER] in?" -> [GI]
            uniquePairs.set('GI-Producer', new Map());
            gameData.filter(p => p.type === 'GI-Producer' && p.right !== 'N/A').forEach(p => {
                 if (!uniquePairs.get('GI-Producer').has(p.right)) {
                    uniquePairs.get('GI-Producer').set(p.right, new Set());
                }
                uniquePairs.get('GI-Producer').get(p.right).add(p.left); // key=Producer, value=Set(GIs)
            });
            uniquePairs.get('GI-Producer').forEach((gis, producer) => {
                flashcardDecks['GI-Producer'].push({
                    prompt: `What GI is this producer in?`,
                    front: producer,
                    back: Array.from(gis).join(' / '),
                    id: `gp-${producer.replace(/\s/g, '')}`,
                    learned: false
                });
            });
        }

        function initFlashcards(mode) {
            currentGameMode = mode; // e.g., 'State-Zone'
            currentFlashcardDeck = flashcardDecks[mode];
            shuffleArray(currentFlashcardDeck);

            // Set title
            if (mode === 'State-Zone') flashcardDeckTitle.textContent = 'State / Zone Deck';
            if (mode === 'Zone-GI') flashcardDeckTitle.textContent = 'Zone / GI Deck';
            if (mode === 'GI-Feature') flashcardDeckTitle.textContent = 'GI / Feature Deck';
            if (mode === 'GI-Producer') flashcardDeckTitle.textContent = 'GI / Producer Deck';

            // Reset study mode filter
            document.querySelector('.study-mode-radio[value="all"]').checked = true;
            buildFilteredDeck();
            showCard(0);

            startModal.classList.add('hidden');
            flashcardMenuModal.classList.add('hidden');
            flashcardContainer.classList.remove('hidden');
        }

        function buildFilteredDeck() {
            const studyMode = document.querySelector('.study-mode-radio:checked').value;
            if (studyMode === 'all') {
                currentFilteredDeck = [...currentFlashcardDeck];
            } else if (studyMode === 'unlearned') {
                currentFilteredDeck = currentFlashcardDeck.filter(card => !card.learned);
            } else if (studyMode === 'learned') {
                currentFilteredDeck = currentFlashcardDeck.filter(card => card.learned);
            }
            isCardFlipped = false;
            flashcard.classList.remove('flipped');
            showCard(0);
        }

        function showCard(index) {
            currentCardIndex = index;
            isCardFlipped = false;
            flashcard.classList.remove('flipped');

            if (currentFilteredDeck.length === 0) {
                flashcard.classList.add('hidden');
                flashcardEmptyDeckMsg.classList.remove('hidden');
                flashcardStatus.textContent = "Card 0 of 0";
                prevCardBtn.disabled = true;
                nextCardBtn.disabled = true;
                toggleLearnedBtn.disabled = true;
                return;
            }

            flashcard.classList.remove('hidden');
            flashcardEmptyDeckMsg.classList.add('hidden');
            toggleLearnedBtn.disabled = false;

            const card = currentFilteredDeck[index];
            
            flashcardFront.querySelector('.flashcard-prompt').textContent = card.prompt;
            flashcardFront.querySelector('.flashcard-content').textContent = card.front;
            flashcardBack.querySelector('.flashcard-answer').textContent = card.back;
            
            flashcardStatus.textContent = `Card ${index + 1} of ${currentFilteredDeck.length}`;

            // Update nav buttons
            prevCardBtn.disabled = (index === 0);
            nextCardBtn.disabled = (index === currentFilteredDeck.length - 1);
            
            // Update learned button
            if (card.learned) {
                toggleLearnedBtn.textContent = 'Mark as Unlearned';
                toggleLearnedBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                toggleLearnedBtn.classList.add('bg-gray-500', 'hover:bg-gray-600');
            } else {
                toggleLearnedBtn.textContent = 'Mark as Learned';
                toggleLearnedBtn.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                toggleLearnedBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            }
        }

        function flipCard() {
            isCardFlipped = !isCardFlipped;
            flashcard.classList.toggle('flipped');
        }

        function nextCard() {
            if (currentCardIndex < currentFilteredDeck.length - 1) {
                showCard(currentCardIndex + 1);
            }
        }

        function prevCard() {
            if (currentCardIndex > 0) {
                showCard(currentCardIndex - 1);
            }
        }

        function toggleLearned() {
            const card = currentFilteredDeck[currentCardIndex];
            // Find this card in the *main* deck and update it
            const mainDeckCard = currentFlashcardDeck.find(c => c.id === card.id);
            mainDeckCard.learned = !mainDeckCard.learned;
            
            // Update the button text immediately
            if (mainDeckCard.learned) {
                toggleLearnedBtn.textContent = 'Mark as Unlearned';
                toggleLearnedBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                toggleLearnedBtn.classList.add('bg-gray-500', 'hover:bg-gray-600');
            } else {
                toggleLearnedBtn.textContent = 'Mark as Learned';
                toggleLearnedBtn.classList.remove('bg-gray-500', 'hover:bg-gray-600');
                toggleLearnedBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            }

            // Re-filter the deck *after* a short delay so the user doesn't
            // see an abrupt change if the card disappears from the filtered deck
            setTimeout(() => {
                buildFilteredDeck();
            }, 200);
        }

        function resetDeck() {
            currentFlashcardDeck.forEach(card => card.learned = false);
            buildFilteredDeck();
            showCard(0);
        }

        function showMainMenu() {
            gameContainer.classList.add('hidden');
            flashcardContainer.classList.add('hidden');
            flashcardMenuModal.classList.add('hidden');
            databaseModal.classList.add('hidden');
            startModal.classList.remove('hidden');
        }


        // --- EVENT LISTENERS ---
        startGameBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                currentGameMode = btn.dataset.mode;
                startModal.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                initGame();
            });
        });
        
        nextRoundBtn.addEventListener('click', hideSuccessModal);
        playAgainBtn.addEventListener('click', hideGameOver);
        gameMainMenuBtn.addEventListener('click', showMainMenu);

        // --- Database Listeners ---
        exploreDataBtn.addEventListener('click', () => {
            processDatabase(); // (Re)process the data
            buildDatabaseExplorer(); // Build the HTML
            databaseModal.classList.remove('hidden');
        });

        closeDbBtn.addEventListener('click', () => {
            databaseModal.classList.add('hidden');
        });

        // --- Flashcard Listeners ---
        flashcardsBtn.addEventListener('click', () => {
            startModal.classList.add('hidden');
            flashcardMenuModal.classList.remove('hidden');
        });

        flashcardMenuBackBtn.addEventListener('click', () => {
            flashcardMenuModal.classList.add('hidden');
            startModal.classList.remove('hidden');
        });

        startFlashcardsBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                initFlashcards(btn.dataset.mode);
            });
        });

        flashcard.addEventListener('click', flipCard);
        prevCardBtn.addEventListener('click', prevCard);
        nextCardBtn.addEventListener('click', nextCard);
        toggleLearnedBtn.addEventListener('click', toggleLearned);
        resetDeckBtn.addEventListener('click', resetDeck);
        studyModeRadios.forEach(radio => radio.addEventListener('change', buildFilteredDeck));
        flashcardMainMenuBtn.addEventListener('click', showMainMenu);


        // --- Initial App Setup ---
        buildFlashcardDecks();

    </script>
</body>
</html>
